{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 48, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lenovo/Documents/erp-sdm-last/src/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\r\n\r\nif (!process.env.DATABASE_URL) {\r\n  console.error(\"DATABASE_URL is missing!\");\r\n}\r\n\r\nconst pool = new Pool({\r\n  connectionString: process.env.DATABASE_URL,\r\n  ssl: {\r\n    rejectUnauthorized: false // Required for Supabase/Vercel Postgres\r\n  }\r\n});\r\n\r\nexport default pool;\r\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;IAC7B,QAAQ,KAAK,CAAC;AAChB;AAEA,MAAM,OAAO,IAAI,qJAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK;QACH,oBAAoB,MAAM,wCAAwC;IACpE;AACF;uCAEe"}},
    {"offset": {"line": 81, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lenovo/Documents/erp-sdm-last/app/api/bootstrap/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport pool from '@/lib/db';\r\nimport bcrypt from 'bcryptjs';\r\n\r\nasync function ensureSeedData() {\r\n  const client = await pool.connect();\r\n  try {\r\n    // Basic Settings\r\n    const resSettings = await client.query('SELECT * FROM settings LIMIT 1');\r\n    if (resSettings.rows.length === 0) {\r\n       const companyProfile = {\r\n        name: 'Sukses Digital Media',\r\n        address: 'Jl. Kemajuan No. 88, Jakarta Selatan',\r\n        phone: '0812-3456-7890',\r\n        logoUrl: '',\r\n        logoPosition: 'top',\r\n        textAlignment: 'center'\r\n      };\r\n      await client.query(\r\n        `INSERT INTO settings (office_lat, office_lng, office_start_time, office_end_time, telegram_bot_token, telegram_group_id, telegram_owner_chat_id, company_profile_json)\r\n         VALUES ($1, $2, $3, $4, '', '', '', $5)`,\r\n        [-6.2, 106.816666, '08:00', '17:00', JSON.stringify(companyProfile)]\r\n      );\r\n    }\r\n    \r\n    // Seed Users if empty\r\n    const resUsers = await client.query('SELECT count(*) FROM users');\r\n    if (parseInt(resUsers.rows[0].count) === 0) {\r\n       const defaultUsers = [\r\n          { id: '1', name: 'Budi Owner', username: 'owner', telegramId: '111', telegramUsername: '@budi_owner', role: 'OWNER', password: 'owner123' },\r\n          { id: '2', name: 'Siti Manager', username: 'manager', telegramId: '222', telegramUsername: '@siti_mgr', role: 'MANAGER', password: 'manager123' },\r\n          { id: '3', name: 'Andi Finance', username: 'finance', telegramId: '333', telegramUsername: '@andi_fin', role: 'FINANCE', password: 'finance123' },\r\n          { id: '4', name: 'Joko Staff', username: 'staff', telegramId: '444', telegramUsername: '@joko_sdm', role: 'STAFF', password: 'staff123' }\r\n       ];\r\n       for (const u of defaultUsers) {\r\n          const hash = await bcrypt.hash(u.password, 10);\r\n          await client.query(\r\n            'INSERT INTO users (id, name, username, telegram_id, telegram_username, role, password_hash) VALUES ($1, $2, $3, $4, $5, $6, $7)',\r\n            [u.id, u.name, u.username, u.telegramId, u.telegramUsername, u.role, hash]\r\n          );\r\n       }\r\n    }\r\n  } catch (e) {\r\n    console.error(\"Seed Check Failed\", e);\r\n  } finally {\r\n    client.release();\r\n  }\r\n}\r\n\r\nexport async function GET() {\r\n  try {\r\n    await ensureSeedData(); // Ensure DB is ready\r\n    \r\n    const client = await pool.connect();\r\n    try {\r\n      const [\r\n        usersRes, projectsRes, attendanceRes, requestsRes, \r\n        transactionsRes, dailyReportsRes, salaryConfigsRes, \r\n        payrollRes, settingsRes\r\n      ] = await Promise.all([\r\n        client.query('SELECT * FROM users'),\r\n        client.query('SELECT * FROM projects'),\r\n        client.query('SELECT * FROM attendance ORDER BY date DESC, time_in DESC LIMIT 500'),\r\n        client.query('SELECT * FROM leave_requests ORDER BY created_at DESC LIMIT 200'),\r\n        client.query('SELECT * FROM transactions ORDER BY date DESC LIMIT 500'),\r\n        client.query('SELECT * FROM daily_reports ORDER BY date DESC LIMIT 200'),\r\n        client.query('SELECT * FROM salary_configs'),\r\n        client.query('SELECT * FROM payroll_records ORDER BY processed_at DESC LIMIT 100'),\r\n        client.query('SELECT * FROM settings LIMIT 1')\r\n      ]);\r\n\r\n      const settingsRow = settingsRes.rows[0];\r\n      const settings = settingsRow ? {\r\n        officeLocation: { lat: settingsRow.office_lat, lng: settingsRow.office_lng },\r\n        officeHours: { start: settingsRow.office_start_time, end: settingsRow.office_end_time },\r\n        telegramBotToken: settingsRow.telegram_bot_token || '',\r\n        telegramGroupId: settingsRow.telegram_group_id || '',\r\n        telegramOwnerChatId: settingsRow.telegram_owner_chat_id || '',\r\n        companyProfile: JSON.parse(settingsRow.company_profile_json || '{}')\r\n      } : {};\r\n\r\n      const data = {\r\n        users: usersRes.rows.map(u => ({\r\n          id: u.id,\r\n          name: u.name,\r\n          username: u.username,\r\n          telegramId: u.telegram_id || '',\r\n          telegramUsername: u.telegram_username || '',\r\n          role: u.role\r\n        })),\r\n        projects: projectsRes.rows.map(p => ({\r\n          id: p.id,\r\n          title: p.title,\r\n          description: p.description || '',\r\n          collaborators: JSON.parse(p.collaborators_json || '[]'),\r\n          deadline: p.deadline ? new Date(p.deadline).toISOString().split('T')[0] : '', \r\n          status: p.status,\r\n          tasks: JSON.parse(p.tasks_json || '[]'),\r\n          comments: p.comments_json ? JSON.parse(p.comments_json) : [],\r\n          isManagementOnly: !!p.is_management_only,\r\n          priority: p.priority,\r\n          createdBy: p.created_by,\r\n          createdAt: Number(p.created_at)\r\n        })),\r\n        attendance: attendanceRes.rows.map(a => ({\r\n          id: a.id,\r\n          userId: a.user_id,\r\n          date: a.date,\r\n          timeIn: a.time_in,\r\n          timeOut: a.time_out || undefined,\r\n          isLate: !!a.is_late,\r\n          lateReason: a.late_reason || undefined,\r\n          selfieUrl: a.selfie_url,\r\n          checkOutSelfieUrl: a.checkout_selfie_url || undefined,\r\n          location: { lat: a.location_lat, lng: a.location_lng }\r\n        })),\r\n        requests: requestsRes.rows.map(r => ({\r\n          id: r.id,\r\n          userId: r.user_id,\r\n          type: r.type,\r\n          description: r.description,\r\n          startDate: new Date(r.start_date).toISOString().split('T')[0],\r\n          endDate: r.end_date ? new Date(r.end_date).toISOString().split('T')[0] : new Date(r.start_date).toISOString().split('T')[0],\r\n          attachmentUrl: r.attachment_url || undefined,\r\n          status: r.status,\r\n          createdAt: Number(r.created_at)\r\n        })),\r\n        transactions: transactionsRes.rows.map(t => ({\r\n          id: t.id,\r\n          date: new Date(t.date).toISOString().split('T')[0],\r\n          amount: Number(t.amount),\r\n          type: t.type,\r\n          category: t.category || '',\r\n          description: t.description,\r\n          account: t.account,\r\n          imageUrl: t.image_url || undefined\r\n        })),\r\n        dailyReports: dailyReportsRes.rows.map(r => ({\r\n          id: r.id,\r\n          userId: r.user_id,\r\n          date: r.date,\r\n          activities: JSON.parse(r.activities_json || '[]')\r\n        })),\r\n        salaryConfigs: salaryConfigsRes.rows.map(c => ({\r\n          userId: c.user_id,\r\n          basicSalary: Number(c.basic_salary),\r\n          allowance: Number(c.allowance),\r\n          mealAllowance: Number(c.meal_allowance),\r\n          lateDeduction: Number(c.late_deduction)\r\n        })),\r\n        payrollRecords: payrollRes.rows.map(pr => ({\r\n          id: pr.id,\r\n          userId: pr.user_id,\r\n          month: pr.month,\r\n          basicSalary: Number(pr.basic_salary),\r\n          allowance: Number(pr.allowance),\r\n          totalMealAllowance: Number(pr.total_meal_allowance),\r\n          bonus: Number(pr.bonus),\r\n          deductions: Number(pr.deductions),\r\n          netSalary: Number(pr.net_salary),\r\n          isSent: !!pr.is_sent,\r\n          processedAt: Number(pr.processed_at),\r\n          metadata: pr.metadata_json ? JSON.parse(pr.metadata_json) : undefined\r\n        })),\r\n        settings\r\n      };\r\n\r\n      return NextResponse.json(data);\r\n    } finally {\r\n      client.release();\r\n    }\r\n  } catch (err) {\r\n    console.error('Bootstrap error', err);\r\n    return NextResponse.json({ error: 'Failed to load initial data' }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}